# 8080 instruction executor for x86

x86系CPUで8080機械語を解釈して実行するモジュールです。  

本モジュールは CP/M-80 2.2用のプログラムを  
MS-DOS上で実行する CP/M Player for generic MS-DOS の  
8080コードエミュレーションモジュールとして開発しました。  

出来上がった 8080EM.BINはOSに依存しないため  
MS-DOS CP/M-86 DR-DOS ベアメタル いずれでも使えます。  

Z80で拡張された命令には対応していません。  
（Z80版は開発中ですが完成度が低いため未公開です）  

## ビルド環境

OS：MS-DOS  
アセンブラ：Microsoft Macro assembler 6.00AD  

上記MASM6.0のほかに生成した 8080EM.EXEの  
EXEヘッダの切り離しにSYMDEBを使っています。  

ファイル構成  
8080EM.ASM --- ソースファイル  
8080.BAT ----- アセンブル、EXEヘッダ切り離しを一連で実行するバッチ  
8080.PAT ----- EXEヘッダ切り離しをSYMVEBで実行するためのスクリプト  
8080EM.LST --- MASMが生成するリスティングファイル  
8080EM.OBJ --- MASMが生成するオブジェクトファイル  
8080EM.EXE --- MASMが生成する実行ファイル（単体での実行は無意味）  
8080EM.BIN --- 8080EM.EXEからEXEヘッダを切り離しOS非依存にしたモジュール  

## 使い方

x86 16bit環境で本モジュールを任意のRAM領域にロード、  
セグメントレジスタ DS には 8080コードをロードしたセグメント値を設定し  
エントリポイント(nnnn:0e0h)を FAR CALL します。  

本モジュールと8080コードのロードに各64KB  
合計128KBの空きエリアが必要です。  

本モジュールではワークエリアとしてメモリは使わず、  
全ての処理をレジスタ上で行っています。  
スタックはエントリ時のFAR CALL分以外消費しません。  

8080のレジスタは、以下の通りx86レジスタに対応させています、  
8080コード実行（FAR CALL）に先立ち、各レジスタを設定しておきます。  

8080 -- x86  
Flag -- AH  
A ----- AL  
B ----- CH  
C ----- CL  
D ----- DH  
E ----- DL  
H ----- BH  
L ----- BL  
PC ---- SI  
SP ---- DI  

リターン条件  

IN、OUT、HLT、未定義命令をフェッチするとその命令は実行せず  
その命令コードのアドレスををSIに、リターンコードをBPに  
8080レジスタ値を対応するレジスタに保持して戻ります。  

リターンコード  
 1: HLT命令  
 2: OUT命令  
 3: IN命令  
 7: 未定義命令  

なお、DI（割り込み禁止命令）は弊害が出る可能性があるため  
実行せずNOP扱いとしています。  

## ライセンス

MITライセンスとします。

## 変更履歴
2024/8/22 Rev. 1.00	初回公開

